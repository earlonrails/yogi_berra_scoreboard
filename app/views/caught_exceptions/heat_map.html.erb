<br>
<table class="table table-striped table-hover table-bordered">
  <tbody>
    <% @map_reduced_caught_exceptions.each_with_index do |caught_exception, index| %>
      <tr>
        <td>
          <button type="button" class="btn btn-warning btn-lg">
            <span class="glyphicon glyphicon-fire"></span> <%= caught_exception["value"]["count"] %>
          </button>
        </td>
        <td>
          <%= caught_exception["_id"] %>
        </td>
        <td>
          <div id="caught_exception_chart<%= index %>" style="width:400px;height:200px"></div>

          <script type="text/javascript">
            var dates = <%= raw caught_exception["value"]["dates"] %>;
            var dateCounter = function(dates) {
              var results = {};
              dates.forEach(function(date){
                date = new Date(date);
                var dateString = date.getDay() + "/" + date.getMonth() + "/" + date.getFullYear();
                if (results.hasOwnProperty(dateString)) {
                  results[dateString] += 1;
                } else {
                  results[dateString] = 0;
                }
              });

              results["dateLabels"] = Object.keys(results);
              results["countArray"] = [];
              results.dateLabels.forEach(function(key){
                results.countArray.push(results[key]);
              });
              return results;
            };

            var dateResults = dateCounter(dates);
            $("#caught_exception_chart<%= index %>").highcharts({
              chart: {
               type: 'column'
              },
              title: {
                text: ""
              },
              xAxis: {
                categories: dateResults.dateLabels
              },
              yAxis: {
                min: 0,
                title: {
                    text: 'Number of errors'
                }
              },
              colors: ['#f0ad4e'],
              series: [{
                data: dateResults.countArray,
                showInLegend: false
              }]
            })
          </script>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
